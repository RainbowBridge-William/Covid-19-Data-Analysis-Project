---
title: "Analysis Report Regarding Questions of COVID-19"
author: "Group A6: Patrick Alexander Abboud, Jeffrey Kaufman, Kyler Smith, & William Wang"
date: "02/26/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
#source("analysis.R")
read.csv("data/COVID-19 Vaccinations in the US/covid19_vaccinations_in_the_united_states.csv")
library("knitr")
```

## Section 1. Problem Domain Description
COVID-19, which is short for coronavirus disease of 2019, is the illness caused by the SARS-CoV-2 virus first identified in Wuhan, China in December of 2019. Since then, the virus has rapidly spread across the world, leading the World Health Organization to declare a global pandemic. Millions of Americans have been infected by the virus, and hundreds of thousands have died due to the disease with those numbers only continuing to grow each day. A global race to develop a vaccine in record-breaking time ensued, with over 100 different candidates being tested across the globe. Despite multiple vaccines receiving emergency authorizations from multiple different nations, the situation is worsening daily as new mutant strains are being identified such as those identified in the United Kingdom. In the United States, public health officials are struggling to convince the populous that the vaccines are safe and effective, leading to widespread anti-vaccine protests seeking to slow the vaccination efforts, which only lends itself to give the virus more time to develop a mutation to defeat the current vaccine formulations.

Thus, analyzing data related to COVID-19 is worthwhile since it will help people understand the overall situation and severity of the pandemic and arouse their interest in adopting protective measures like mask-wearing, social-distancing, and vaccination. In addition, analyzing this data may expose differences in the ability of different regulations between states to contain the virus, which may prove beneficial in helping state governments are only utilizing restrictions that truly work to contain this pathogen.

## Section 2. Data Description
```{r section_2, include = FALSE}
source("section_2.R")
source("section_3.R")
```

#### JHU CSSE COVID-19 Data

The [COVID-19 Data Repository by the Center for System Science and Engineering (CSSE) at Johns Hopkins University](https://github.com/CSSEGISandData/COVID-19) is compiled from sources such as, but not limited to, the World Health Organization and the United States Centers for Disease Control and Prevention (a list of all data sources is provided in the `README.md` file of the repository) provides case and deaths counts for each state/U.S. territory for each day since the SARS-CoV-2 virus was first detected in Washington state in January of 2020. This data set has been known to provide some of the most up-to-date information possible, which has resulted in many different organizations citing this data as trustworthy and reliable.

```{r jhu_cases_time_series_sample_table}
kable(head(jhu_cases_time_series_sample_df))
```

```{r jhu_deaths_time_series_sample_table}
kable(head(jhu_deaths_time_series_sample_df))
```

##### Data Set Features of Note

- `Admin2`: name of county/political subdivision of U.S. state/territory
- `Province_State`: name of U.S. state/territory
- `Xmm.dd.yy`: one feature per day since the SARS_CoV_2 virus was first detected in the United States representing the case/death count of the county/political subdivision definied by the `Admin2` feature; takes the format of `Xmm.dd.yy` where `mm` is the one- or two-digit month as a decimal, `dd` is the one- or two-digit day of the month as a decimal, and `yy` is the two-digit year without century as a decimal

---

#### HIFLD Hospitals

The [Homeland Infrastructure Foundation-Level Data Hospitals](https://hifld-geoplatform.opendata.arcgis.com/datasets/hospitals) (HIFLD Hospitals) data set published by the United States Department of Homeland Security and compiled from sources from the United States Department of Health & Human Services and Centers for Disease Control and Prevention provides a list of all hospitals in the United States and their associated trauma level. It identifies how many hospitals and of what type exist in each state.

```{r hifld_hospitals_sample}
kable(head(hifld_hospitals_sample_df))
```

##### Data Set Features of Note

- `STATE`: two-letter U.S.P.S. abbreviation of state name
- `TYPE`: type of hospital; value can be `"GENERAL ACUTE CARE"`, `"CRITICAL ACCESS"`, `"PSYCHIATRIC"`, `"LONG TERM CARE"`, `"REHABILITATION"`, `"MILITARY"`, `"SPECIAL"`, `"CHILDREN"`, `"WOMEN"`, or `"CHRONIC DISEASE"`
- `STATUS`: current status of hospital; value either `"OPEN"` or `"CLOSED"`
- `LATITUDE`: latitude of hospital
- `LONGITUDE`: longitude of hospital
- `BEDS`: number of beds available at hospital; value of `-999` represents an unknown count of beds
- `TRAUMA`: non-standard trauma center level identifier (definitions can be found in the [HIFLD Trauma Levels Data Set](https://hifld-geoplatform.opendata.arcgis.com/datasets/trauma-levels)); value of `"NOT AVAILABLE"` indicates the hospital is not classified as a trauma center

---

#### NYT Mask-Wearing Survey
The [NYT Mask-Wearing Survey data set](https://github.com/nytimes/covid-19-data/tree/master/mask-use) contains estimates of mask-usage from 250,000 survey responses for each county in the US. Each participant was asked "How often do you wear a mask in public when you expect to be within six feet of another person?" and given the choices of never, rarely, sometimes, frequently, or always. The survey was done in 2020 from July 2 to July 14, and was assembled by The New York Times and Dynata.

```{r nyt_mask_wearing_survey_sample}
kable(head(mask_use_by_county_df))
```

The `COUNTYFP` column is the FIPS code for the county, and the rest of the columns are estimates for the percent of people in that county who responded with that option. Those values always add up to about one.

---

#### CDC COVID-19 Vaccinations in the United States
The [COVID-19 Vaccinations in the United States data set](https://covid.cdc.gov/covid-data-tracker/#vaccinations) contains number of vaccine doses administered by state. Data on COVID-19 vaccine doses administered in the United States are collected by vaccination providers and reported to CDC through multiple sources, including jurisdictions, pharmacies, and federal entities, which use various reporting methods, including Immunization Information Systems, Vaccine Administration Management System, and direct data submission. 

```{r vaccination_by_state_sample}
kable(head(vaccination_by_state_df))
```

- `Total doses administered` column is the total number of vaccine doses that have been given to people. 

- `Doses administered per 100k` column is the total number of vaccine doses given for every 100,000 people.

- `18+ Doses Administered` column is the total number of vaccine doses that have been given to people for the overall population

- `18+ Doses administered per 100k` column is the total number of vaccine doses given for every 100,000 people aged 18 years and older.

---

### Subsection 2.2 Summary Analysis

#### JHU CSSE COVID-19 Data

Between `r jhu_date_range[1]` to `r jhu_date_range[2]`, `r jhu_cases_recorded` total cases of COVID-19 have been detected in the United States and `r jhu_deaths_recorded` total deaths have been ruled as being caused by COVID-19.

```{r jhu_cases_deaths_time_series_summary_df}
kable(jhu_cases_deaths_time_series_summary_df)
```

```{r total_cases_state_distribution_plot}
total_cases_state_distribution_plot
```

```{r total_deaths_state_distribution_plot}
total_deaths_state_distribution_plot
```

```{r total_cases_deaths_by_date_plot}
total_cases_deaths_by_date_plot
```

As seen in the distributions of cases and deaths by state, California and Texas both appear as outliers with higher numbers of both cases and deaths. However, when the population of these states is taken into account, it begins to provide a possible explanation of the higher numbers found in these states. Additionally, the epidemiologic data suggests that mutated variants of the SARS-CoV-2 that are more infectious and transmissible may be to blame for the high number of cases in these states.

---

#### HIFLD Hospitals

As seen in the above visualizations of the geographic distributions of hospitals and trauma centers in the United States, health care institutions tend to be located around population centers. The distributions also show that larger states with larger populations have more hospitals and trauma centers, and are more likely to have lower level trauma centers. Additionally, lower level trauma centers, on average, have more beds for patients that facilities with a higher trauma level.

```{r hifld_hospitals_summary_df}
kable(hifld_hospitals_summary_df)
```

```{r covid_related_hospitals_state_distribution_plot}
covid_related_hospitals_state_distribution_plot
```

```{r trauma_centers_state_distribution_plot}
trauma_centers_state_distribution_plot
```

```{r trauma_centers_beds_distribution_plot}
trauma_centers_beds_distribution_plot
```

As seen in the box plot, there are quite a few outliers when it comes to the distribution of beds among trauma center levels. This is likely due to the different populations of different regions, as facilities in more highly-populated areas will need more beds for patients than those in rural areas. It is likely that trauma centers are created based not on population, but rather, geographic distance to another facility able to provide the same level of care.

---

#### NYT Mask-Wearing Survey
Grouped by counties, an average of `r round(mean(mask_use_by_county_df$ALWAYS) * 100)`% of the responses are "Always," and an average of `r round(mean(mask_use_by_county_df$NEVER) * 100)`% of the responses are "Never." For a single county, the values for each response are supposed to sum to one. In reality, the values are rounded to three decimal places, so the sum for each county ranges from `r min(mask_use_by_county_sum_df$sum)` to `r max(mask_use_by_county_sum_df$sum)`.

```{r mask_use_by_county_summary_df}
kable(mask_use_by_county_summary_df)
```

```{r mask_use_violin_plot}
mask_use_violin_plot
```

```{r mask_use_always_map}
mask_use_always_map
```

```{r mask_use_never_map}
mask_use_never_map
```

There doesn't seem to be any significant outliers. This is probably because there were 250,000 survey responses for a survey with only 5 options. Any individual county would have to have a lot of different responses in order to be able to become an outlier. Also, there is less chance for outliers because this data set was grouped into counties, forcing all of the columns for each row to sum to one. There are no NA values, and it seems to have data for almost every county.

---

#### **CDC COVID-19 Vaccinations in the United States**
By Feb 22th, there are `r sum_vaccination` people in the US got vaccination. Grouped by states, there are an average of `r mean_vaccination_per_100k` per 100,000 (`r mean_ratio_per_100k * 100`%) of population in the US given doses. The number of doses administered per 100,000 ranges from `r min_vaccination_per_100k` to `r max_vaccination_per_100k`. 

```{r vaccination_by_state_summary_df_}
kable(vaccination_by_state_summary_df)
```

```{r map_total_vaccination}
map_total_vaccination
```

```{r map_percent_vaccination}
map_percent_vaccination
```

```{r top_5_percent_vaccination_plot}
top_5_percent_vaccination_plot
```

The most significant outlier in the data set is the total vaccination population in California. The possible reason might be overall education level in that states is high and also the population base in CA is large so that there are a great number of people taking the vaccine.

---

## Section 3: Specific Question Analysis

#### Does the number and types of hospitals affect the death rate in each state, and if so, how?

#### Does the percent of vaccination population in each state affect the rate of cases? If so, how?
Rate of cases here is the ratio of new cases and total population for each state on the most recent date. Percent of vaccination population is the percentage of population that has given a vaccine.

To do the data analysis, I first calculate the new cases of each state on most recent date. Then I calculate the rate of cases by taking the ratio of new cases and population of each state. Lastly I compare the rate of cases with percent of vaccination to find potential relationship.

```{r vaccine_vs_rate_case}
kable(vaccine_vs_rate_case, col.names = c("State", "Most Recent Ratio of Vaccination Population", "Case Rate at Most Recent Date"))
```

```{r vaccine_vs_rate_case_scatter_plot}
vaccine_vs_rate_case_scatter_plot
```

According to both quantitative and graphical result, it shows that there are no strong correlation between Ratio of Vaccination Population and Case Rate in each state at most recent date. 

This result is unexpected to me. I was originally sure of this correlation. My assumption is as the percentage of vaccination population goes up, the cases rate goes down. The possible reasons for this unexpectency are:

- Lack of data due to the fact that CDC vaccination overtime data By State is not available to public. Only vaccination data for each state at most recent data and overtime data for the entire US is available
- Other than vaccination, there are many other factors influencing the case rate, such as different quarantine policy across differenct states, different attitude towards mask, and different population density.
- The result of vaccination may take a longer time to reflect on the case rate since there are still relatively few people taken the vaccine and the actual implement of vaccine is less than three month.